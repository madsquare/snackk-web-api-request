!function(e,t){"function"==typeof define?define(["jquery","jquery-cookie","jquery-iframe-transport","lodash"],t):"object"==typeof exports?module.exports=t():e.request=t()}(this,function(){var e,t,r;return function(n){function s(e,t){var r,n,s,o,u,a,i,c,l,f,h=t&&t.split("/"),p=y.map,d=p&&p["*"]||{};if(e&&"."===e.charAt(0)&&t){for(h=h.slice(0,h.length-1),e=h.concat(e.split("/")),c=0;f=e[c];c++)if("."===f)e.splice(c,1),c-=1;else if(".."===f){if(1===c&&(".."===e[2]||".."===e[0]))return!0;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}if((h||d)&&p){for(r=e.split("/"),c=r.length;c>0;c-=1){if(n=r.slice(0,c).join("/"),h)for(l=h.length;l>0;l-=1)if(s=p[h.slice(0,l).join("/")],s&&(s=s[n])){o=s,u=c;break}if(o)break;!a&&d&&d[n]&&(a=d[n],i=c)}!o&&a&&(o=a,u=i),o&&(r.splice(0,u,o),e=r.join("/"))}return e}function o(e,t){return function(){return h.apply(n,T.call(arguments,0).concat([e,t]))}}function u(e){return function(t){return s(t,e)}}function a(e){return function(t){p[e]=t}}function i(e){if(d.hasOwnProperty(e)){var t=d[e];delete d[e],m[e]=!0,f.apply(n,t)}if(!p.hasOwnProperty(e))throw new Error("No "+e);return p[e]}function c(e,t){var r,n,o=e.indexOf("!");return-1!==o?(r=s(e.slice(0,o),t),e=e.slice(o+1),n=i(r),e=n&&n.normalize?n.normalize(e,u(t)):s(e,t)):e=s(e,t),{f:r?r+"!"+e:e,n:e,p:n}}function l(e){return function(){return y&&y.config&&y.config[e]||{}}}var f,h,p={},d={},y={},m={},T=[].slice;f=function(e,t,r,s){var u,f,h,y,T,_,g=[];if(s=s||e,"function"==typeof r){for(t=!t.length&&r.length?["require","exports","module"]:t,_=0;_<t.length;_++)if(T=c(t[_],s),h=T.f,"require"===h)g[_]=o(e);else if("exports"===h)g[_]=p[e]={},u=!0;else if("module"===h)f=g[_]={id:e,uri:"",exports:p[e],config:l(e)};else if(p.hasOwnProperty(h)||d.hasOwnProperty(h))g[_]=i(h);else if(T.p)T.p.load(T.n,o(s,!0),a(h),{}),g[_]=p[h];else if(!m[h])throw new Error(e+" missing "+h);y=r.apply(p[e],g),e&&(f&&f.exports!==n&&f.exports!==p[e]?p[e]=f.exports:y===n&&u||(p[e]=y))}else e&&(p[e]=r)},e=t=h=function(e,t,r,s){return"string"==typeof e?i(c(e,t).f):(e.splice||(y=e,t.splice?(e=t,t=r,r=null):e=n),t=t||function(){},s?f(n,e,t,r):setTimeout(function(){f(n,e,t,r)},15),h)},h.config=function(e){return y=e,h},r=function(e,t,r){t.splice||(r=t,t=[]),d[e]=[e,t,r]},r.amd={jQuery:!0}}(),r("../almond",function(){}),function(){r("request",["lodash","jquery","jquery-iframe-transport"],function(e,t){var r,n,s,o,u;return u="v2",o={"X-SNACKK-CLIENT-ID":null,"X-SNACKK-CLIENT-SECRET":null,"X-SNACKK-TZ-OFFSET":null,"X-SNACKK-COUNTRY":null,"X-SNACKK-APP-VER":null},s=null,n={REFRESHING:"token.refresh",NOT_EXIST_TOKEN:"token.not_exist"},r=function(){function r(e){return this.setHeaderObj(e),s=e.baseUrl,this.tokenModule=e.tokenModule,this}return r.prototype.refreshRequestQueue=[],r.prototype.options=null,r.prototype.state=null,r.prototype.hasRequest={},r.prototype.requestData={},r.prototype.timeoutDuration=7e3,r.prototype.setHeaderObj=function(e){return o["X-SNACKK-CLIENT-ID"]=e.clientId,o["X-SNACKK-CLIENT-SECRET"]=e.clientSecret,o["X-SNACKK-TZ-OFFSET"]=(new Date).getTimezoneOffset(),o["X-SNACKK-COUNTRY"]="KR",o["X-SNACKK-APP-VER"]=Number(e.versionCode),-1!==location.hostname.indexOf("cn")?o["X-SNACKK-COUNTRY"]="CN":-1!==location.hostname.indexOf("snackk.me")?(o["X-SNACKK-COUNTRY"]="TW",o["Accept-Language"]="zh-TW"):void 0},r.prototype.request=function(r,u){var a,i,c,l,f,h,p,d,y,m,T,_;if(h={url:s+r,type:"GET",headers:o,dataType:"json",contentType:"application/json; charset=utf-8"},y=r+JSON.stringify(u.data),m=r,this.hasRequest[y])return console.info("server] request ignore :"+y),this.hasRequest[y];if(this.state===n.REFRESHING&&"auth/refresh"!==m)return console.debug("token-expired] queue.push : "+m+" / "+JSON.stringify(u)),void this.refreshRequestQueue.push({url:m,data:u});if("undefined"!=typeof u.type&&(h.type=u.type),"undefined"!=typeof u.dataType&&(h.dataType=u.dataType),"undefined"!=typeof u.data&&u.type)h.data=JSON.stringify(u.data);else if(u.data){h.data=u.data,d=u.data;for(f in d)_=d[f],("object"==typeof _||"array"==typeof _)&&(h.data[f]=JSON.stringify(_))}else h.data=u.data;return u.headers&&(h.headers=e.assign(h.headers,u.headers)),t.inArray(h.type,["PUT","DELETE"])>-1&&(h.headers["X-HTTP-Method-Override"]=h.type,h.type="POST"),(a=this.tokenModule.getAccessToken())&&this.state!==n.REFRESHING&&(h.headers.Authorization="Bearer "+a),this.requestData[y]=u,i=function(e){return function(){return delete e.hasRequest[y],delete e.requestData[y]}}(this),c=function(e){return function(t,r,n){return T&&clearTimeout(T),e.repeatTokenRequestCount=0,i(),"string"==typeof t.nonce&&(t.nonce=JSON.parse(t.nonce)),e.done(t,r,n),u.success&&u.success(t,r,n)}}(this),l=function(e){return function(t){var s,o;if(T&&clearTimeout(T),!t)return console.error("server-error] 반환된 error객체가 없음."),!1;if(i(),0===t.readyState||"abort"===t.statusText||"No Transport"===t.statusText)return!1;if(t.responseText&&(o=JSON.parse(t.responseText),o&&(s=o.error)),s&&"common.expired_access_token"===s.type){if("auth/refresh"!==m&&(console.debug("token-expired] queue.push : "+m+" / "+JSON.stringify(u)),e.refreshRequestQueue.push({url:m,data:u})),e.state!==n.REFRESHING)return e.state=n.REFRESHING,e.refreshToken({success:function(t){var r,n;e.state=null;try{for("string"==typeof t&&(t=JSON.parse(t.responseText)),e.tokenModule.setToken(t.token),r=0,n=[];r<e.refreshRequestQueue.length;)console.debug("token-expired] queue.실행 : "+e.refreshRequestQueue[r].url),e.request(e.refreshRequestQueue[r].url,e.refreshRequestQueue[r].data),n.push(e.refreshRequestQueue.shift());return n}catch(o){s=o}},error:function(e){}}),t}else{if(s&&"common.not_exist_token"===s.type)return e.state!==n.NOT_EXIST_TOKEN&&"auth/refresh"!==r?(e.state=n.NOT_EXIST_TOKEN,e.repeatTokenRequestCount++,e.request(r,u),t):void e.responseInvalidToken();(u.error&&u.error(s))!==!1&&s&&500!==s.code&&setTimeout(function(){return e.responseError(s.message)},100)}return e.fail(t),t}}(this),-1!==h.dataType.indexOf("iframe")&&(p=c,c=function(e,t,r){return e&&"undefined"==typeof e.error?p(e,t,r):l(e)},h.method="POST",h.formData=[],h.data||(h.data={}),"undefined"!=typeof h.headers.Authorization?(h.data.access_token=h.headers.Authorization,h.data.x_snackk_country=h.headers["X-SNACKK-COUNTRY"]):(h.data.client_id=h.headers["X-SNACKK-CLIENT-ID"],h.data.client_secret=h.headers["X-SNACKK-CLIENT-SECRET"],h.data.x_snackk_country=h.headers["X-SNACKK-COUNTRY"]),h.data.redirect=[location.protocol,"//",location.host].join("")+"/result?%s",8e3===parseInt(location.port,10)&&(h.data.redirect=[location.protocol,"//",location.host].join("")+"/result.html?%s"),e.forEach(h.data,function(e,t){return h.formData.push({name:t,value:e})}),h.fileInput=u.fileInput),T=setTimeout(function(e){return function(){return e.timeoutReqeust()}}(this),this.timeoutDuration),this.beforeRequest(),h.success=c,h.error=l,h.complete=u.complete,this.hasRequest[r]={},this.hasRequest[r].reqId=y,this.hasRequest[r].request=this.hasRequest[y]=t.ajax(h)},r.prototype.refreshToken=function(e){return this.request("auth/refresh",{type:"POST",data:{refresh_token:this.tokenModule.getRefreshToken()},success:function(t){return function(t){return e&&e.success&&e.success(t)}}(this),error:function(t){return e&&e.error&&e.error(t)},complete:function(t){return e&&e.complete&&e.complete(t)}})},r.prototype.beforeRequest=function(e){},r.prototype.fail=function(e){},r.prototype.done=function(e,t,r){},r.prototype.timeoutReqeust=function(){},r.prototype.responseInvalidToken=function(){},r.prototype.responseError=function(e){},r.prototype.TAG={auth:{refresh:"auth/refresh",clear:"auth/clear",authorize:"auth/authorize"},app:{tvs:"app/tvs",facebooktv:"app/facebooktv"},notice:"app/web",search:{target:"search/:target",url:"videos/validate"},channels:{get:"channels",ch_no:"channels/:ch_no",url:"channels/:url",broadcast:"channels/:ch_no",subscribers:"channels/:ch_no/subscribers",comments:"channels/:ch_no/comments",comment:"channels/:ch_no/comments/:cc_no"},resources:{postTemporaryResources:"user/:us_no/channels/:ch_no/resources/:operation",putTemporaryResources:"user/:us_no/channels/:ch_no/resources/:cr_no",temporaryResourcesExclude:"user/:us_no/channels/:ch_no/resources/all/:operation",temporaryResources:"user/:us_no/channels/:ch_no/resources",temporaryExclude:"user/:us_no/channels/:ch_no/resources/truncate",cancelTemporary:"user/:us_no/channels/:ch_no/histories/:hi_no",onair:"channels/:ch_no/resources",storage:"user/:us_no/resources",storageProvider:"user/:us_no/resources/:provider",storageExclude:"user/:us_no/resources/truncate",resource:"user/:us_no/resources/:rs_no"},resource:{get:"resources/:rs_no"},user:{get:"user",emailPost:"user/email/verify",aUser:"user/:us_no",profile:"user/:us_no/picture",profileDefault:"user/:us_no/picture/default",channels:"user/:us_no/channels",subscriptions:"user/:us_no/subscriptions",subscribe:"user/:us_no/subscriptions/:ch_no",channel:"user/:us_no/channels/:ch_no",channel_logo:"user/:us_no/channels/:ch_no/logo",channelLogoDefault:"channels/:ch_no/logo/default",provider:"user/:us_no/sns/:provider"},report:"reports",activity:{getActivities:"activities",read:"activities/read"},category:{categories:"categories",channels:"categories/:ca_no/channels"},timeline:{channels:"timelines/channels"},stat:{total:"channels/:ch_no/stats/:begin/:end/:step",rank:"channels/:ch_no/stats/ranking"},event:{post:"events/applicants/:target"},recommend:{channels:"search/recommend/channels",users:"search/recommend/users",resources:"search/recommend/resources/group"}},r}()})}.call(this),r("jquery",function(){return $}),r("jquery-iframe-transport",function(){}),r("lodash",function(){return _}),t("request")});
//# sourceMappingURL=snackk-web-api-request.min.js.map