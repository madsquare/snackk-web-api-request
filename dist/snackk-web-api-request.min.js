!function(e,t){"function"==typeof define?define(["jquery","jquery-cookie","jquery-iframe-transport","lodash"],t):"object"==typeof exports?module.exports=t():e.request=t()}(this,function(){var e,t,r;return function(n){function o(e,t){var r,n,o,s,u,a,i,c,l,h,p=t&&t.split("/"),f=y.map,d=f&&f["*"]||{};if(e&&"."===e.charAt(0)&&t){for(p=p.slice(0,p.length-1),e=p.concat(e.split("/")),c=0;h=e[c];c++)if("."===h)e.splice(c,1),c-=1;else if(".."===h){if(1===c&&(".."===e[2]||".."===e[0]))return!0;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}if((p||d)&&f){for(r=e.split("/"),c=r.length;c>0;c-=1){if(n=r.slice(0,c).join("/"),p)for(l=p.length;l>0;l-=1)if(o=f[p.slice(0,l).join("/")],o&&(o=o[n])){s=o,u=c;break}if(s)break;!a&&d&&d[n]&&(a=d[n],i=c)}!s&&a&&(s=a,u=i),s&&(r.splice(0,u,s),e=r.join("/"))}return e}function s(e,t){return function(){return p.apply(n,T.call(arguments,0).concat([e,t]))}}function u(e){return function(t){return o(t,e)}}function a(e){return function(t){f[e]=t}}function i(e){if(d.hasOwnProperty(e)){var t=d[e];delete d[e],m[e]=!0,h.apply(n,t)}if(!f.hasOwnProperty(e))throw new Error("No "+e);return f[e]}function c(e,t){var r,n,s=e.indexOf("!");return-1!==s?(r=o(e.slice(0,s),t),e=e.slice(s+1),n=i(r),e=n&&n.normalize?n.normalize(e,u(t)):o(e,t)):e=o(e,t),{f:r?r+"!"+e:e,n:e,p:n}}function l(e){return function(){return y&&y.config&&y.config[e]||{}}}var h,p,f={},d={},y={},m={},T=[].slice;h=function(e,t,r,o){var u,h,p,y,T,_,g=[];if(o=o||e,"function"==typeof r){for(t=!t.length&&r.length?["require","exports","module"]:t,_=0;_<t.length;_++)if(T=c(t[_],o),p=T.f,"require"===p)g[_]=s(e);else if("exports"===p)g[_]=f[e]={},u=!0;else if("module"===p)h=g[_]={id:e,uri:"",exports:f[e],config:l(e)};else if(f.hasOwnProperty(p)||d.hasOwnProperty(p))g[_]=i(p);else if(T.p)T.p.load(T.n,s(o,!0),a(p),{}),g[_]=f[p];else if(!m[p])throw new Error(e+" missing "+p);y=r.apply(f[e],g),e&&(h&&h.exports!==n&&h.exports!==f[e]?f[e]=h.exports:y===n&&u||(f[e]=y))}else e&&(f[e]=r)},e=t=p=function(e,t,r,o){return"string"==typeof e?i(c(e,t).f):(e.splice||(y=e,t.splice?(e=t,t=r,r=null):e=n),t=t||function(){},o?h(n,e,t,r):setTimeout(function(){h(n,e,t,r)},15),p)},p.config=function(e){return y=e,p},r=function(e,t,r){t.splice||(r=t,t=[]),d[e]=[e,t,r]},r.amd={jQuery:!0}}(),r("../almond",function(){}),function(){r("request",["lodash","jquery","jquery-iframe-transport"],function(e,t){var r,n,o,s,u;return u="v2",s={"X-SNACKK-CLIENT-ID":null,"X-SNACKK-CLIENT-SECRET":null,"X-SNACKK-TZ-OFFSET":null,"X-SNACKK-COUNTRY":null,"X-SNACKK-APP-VER":null},o=null,n={REFRESHING:"token.refresh",NOT_EXIST_TOKEN:"token.not_exist"},r=function(){function r(e){return this.setHeaderObj(e),o=e.baseUrl,this.tokenModule=e.tokenModule,this.env=e.env,this}return r.prototype.refreshRequestQueue=[],r.prototype.options=null,r.prototype.state=null,r.prototype.hasRequest={},r.prototype.requestData={},r.prototype.timeoutDuration=7e3,r.prototype.env=null,r.prototype.setHeaderObj=function(e){return s["X-SNACKK-CLIENT-ID"]=e.clientId,s["X-SNACKK-CLIENT-SECRET"]=e.clientSecret,s["X-SNACKK-TZ-OFFSET"]=(new Date).getTimezoneOffset(),s["X-SNACKK-COUNTRY"]="KR",s["X-SNACKK-APP-VER"]=Number(e.versionCode),-1!==location.hostname.indexOf("cn")?s["X-SNACKK-COUNTRY"]="CN":-1!==location.hostname.indexOf("snackk.me")?(s["X-SNACKK-COUNTRY"]="TW",s["Accept-Language"]="zh-TW"):void 0},r.prototype.request=function(r,u){var a,i,c,l,h,p,f,d,y,m,T,_;if(p={url:o+r,type:"GET",headers:s,dataType:"json",contentType:"application/json; charset=utf-8"},y=r+JSON.stringify(u.data),m=r,this.hasRequest[y])return console.info("server] request ignore :"+y),this.hasRequest[y];if(this.state===n.REFRESHING&&"auth/refresh"!==m)return console.debug("token-expired] queue.push : "+m+" / "+JSON.stringify(u)),void this.refreshRequestQueue.push({url:m,data:u});if("undefined"!=typeof u.type&&(p.type=u.type),"undefined"!=typeof u.dataType&&(p.dataType=u.dataType),"undefined"!=typeof u.data&&u.type)p.data=JSON.stringify(u.data);else if(u.data){p.data=u.data,d=u.data;for(h in d)_=d[h],("object"==typeof _||"array"==typeof _)&&(p.data[h]=JSON.stringify(_))}else p.data=u.data;return u.headers&&(p.headers=e.assign(p.headers,u.headers)),t.inArray(p.type,["PUT","DELETE"])>-1&&(p.headers["X-HTTP-Method-Override"]=p.type,p.type="POST"),(a=this.tokenModule.getAccessToken())&&this.state!==n.REFRESHING&&(p.headers.Authorization="Bearer "+a),this.requestData[y]=u,i=function(e){return function(){return delete e.hasRequest[y],delete e.requestData[y]}}(this),c=function(e){return function(t,r,n){return T&&clearTimeout(T),e.repeatTokenRequestCount=0,i(),"string"==typeof t.nonce&&(t.nonce=JSON.parse(t.nonce)),e.done(t,r,n),u.success&&u.success(t,r,n)}}(this),l=function(e){return function(t){var o,s;if(T&&clearTimeout(T),!t)return console.error("server-error] 반환된 error객체가 없음."),!1;if(i(),0===t.readyState||"abort"===t.statusText||"No Transport"===t.statusText)return!1;if(t.responseText&&(s=JSON.parse(t.responseText),s&&(o=s.error)),o&&"common.expired_access_token"===o.type){if("auth/refresh"!==m&&(console.debug("token-expired] queue.push : "+m+" / "+JSON.stringify(u)),e.refreshRequestQueue.push({url:m,data:u})),e.state!==n.REFRESHING)return e.state=n.REFRESHING,e.refreshToken({success:function(t){var r,n;e.state=null;try{for("string"==typeof t&&(t=JSON.parse(t.responseText)),e.tokenModule.setToken(t.token),r=0,n=[];r<e.refreshRequestQueue.length;)console.debug("token-expired] queue.실행 : "+e.refreshRequestQueue[r].url),e.request(e.refreshRequestQueue[r].url,e.refreshRequestQueue[r].data),n.push(e.refreshRequestQueue.shift());return n}catch(s){o=s}},error:function(e){}}),t}else{if(o&&"common.not_exist_token"===o.type)return e.state!==n.NOT_EXIST_TOKEN&&"auth/refresh"!==r?(e.state=n.NOT_EXIST_TOKEN,e.repeatTokenRequestCount++,e.request(r,u),t):void e.responseInvalidToken();(u.error&&u.error(o))!==!1&&o&&500!==o.code&&setTimeout(function(){return e.responseError(o.message)},100)}return e.fail(t),t}}(this),-1!==p.dataType.indexOf("iframe")&&(f=c,c=function(e,t,r){return e&&"undefined"==typeof e.error?f(e,t,r):l(e)},p.method="POST",p.formData=[],p.data||(p.data={}),"undefined"!=typeof p.headers.Authorization?(p.data.access_token=p.headers.Authorization,p.data.x_snackk_country=p.headers["X-SNACKK-COUNTRY"]):(p.data.client_id=p.headers["X-SNACKK-CLIENT-ID"],p.data.client_secret=p.headers["X-SNACKK-CLIENT-SECRET"],p.data.x_snackk_country=p.headers["X-SNACKK-COUNTRY"]),p.data.redirect=[location.protocol,"//",location.host].join("")+"/result?%s",8e3===parseInt(location.port,10)&&(p.data.redirect=[location.protocol,"//",location.host].join("")+"/result.html?%s"),e.forEach(p.data,function(e,t){return p.formData.push({name:t,value:e})}),p.fileInput=u.fileInput),T=setTimeout(function(e){return function(){return e.timeoutReqeust()}}(this),this.timeoutDuration),this.beforeRequest(),p.success=c,p.error=l,p.complete=u.complete,this.hasRequest[r]={},this.hasRequest[r].reqId=y,this.hasRequest[r].request=this.hasRequest[y]=t.ajax(p)},r.prototype.refreshToken=function(e){return this.request("auth/refresh",{type:"POST",data:{refresh_token:this.tokenModule.getRefreshToken()},success:function(t){return function(t){return e&&e.success&&e.success(t)}}(this),error:function(t){return e&&e.error&&e.error(t)},complete:function(t){return e&&e.complete&&e.complete(t)}})},r.prototype.beforeRequest=function(e){},r.prototype.fail=function(e){},r.prototype.done=function(e,t,r){},r.prototype.timeoutReqeust=function(){},r.prototype.responseInvalidToken=function(){},r.prototype.responseError=function(e){},r.prototype.TAG={auth:{refresh:"auth/refresh",clear:"auth/clear",authorize:"auth/authorize"},app:{tvs:"app/tvs",facebooktv:"app/facebooktv"},notice:"app/web",search:{target:"search/:target",url:"videos/validate"},channels:{get:"channels",ch_no:"channels/:ch_no",url:"channels/:url",broadcast:"channels/:ch_no",subscribers:"channels/:ch_no/subscribers",comments:"channels/:ch_no/comments",comment:"channels/:ch_no/comments/:cc_no"},resources:{postTemporaryResources:"user/:us_no/channels/:ch_no/resources/:operation",putTemporaryResources:"user/:us_no/channels/:ch_no/resources/:cr_no",temporaryResourcesExclude:"user/:us_no/channels/:ch_no/resources/all/:operation",temporaryResources:"user/:us_no/channels/:ch_no/resources",temporaryExclude:"user/:us_no/channels/:ch_no/resources/truncate",cancelTemporary:"user/:us_no/channels/:ch_no/histories/:hi_no",onair:"channels/:ch_no/resources",storage:"user/:us_no/resources",storageProvider:"user/:us_no/resources/:provider",storageExclude:"user/:us_no/resources/truncate",resource:"user/:us_no/resources/:rs_no"},resource:{get:"resources/:rs_no"},user:{get:"user",emailPost:"user/email/verify",aUser:"user/:us_no",profile:"user/:us_no/picture",profileDefault:"user/:us_no/picture/default",channels:"user/:us_no/channels",subscriptions:"user/:us_no/subscriptions",subscribe:"user/:us_no/subscriptions/:ch_no",channel:"user/:us_no/channels/:ch_no",channel_logo:"user/:us_no/channels/:ch_no/logo",channelLogoDefault:"channels/:ch_no/logo/default",provider:"user/:us_no/sns/:provider"},report:"reports",activity:{getActivities:"activities",read:"activities/read"},category:{categories:"categories",channels:"categories/:ca_no/channels"},timeline:{channels:"timelines/channels"},stat:{total:"channels/:ch_no/stats/:begin/:end/:step",rank:"channels/:ch_no/stats/ranking"},event:{post:"events/applicants/:target"},recommend:{channels:"search/recommend/channels",users:"search/recommend/users",resources:"search/recommend/resources/group"}},r}()})}.call(this),r("jquery",function(){return $}),r("jquery-iframe-transport",function(){}),r("lodash",function(){return _}),t("request")});
//# sourceMappingURL=snackk-web-api-request.min.js.map